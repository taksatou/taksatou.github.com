---
categories: tmux
date: 2011/12/06 01:05:10
title: tmuxに独自コマンドを追加する
---

これは[ターミナルマルチプレクサ Advent Calendar 2011](http://atnd.org/events/22320)の6日目です。
5日目はyoshikawさんの[開発版GNU Screenを使ってみよう](http://yskwkzhr.blogspot.com/2011/12/lets-use-development-version-gnu-screen.html)でした。

---


# はじめに

tmuxは比較的若いプロジェクトなこともあってか、かゆいところに手が届かないシチュエーションがたまにあります。
個人的にバッファの挙動が不満だったのでtmuxをいじってみたところ、
意外と簡単だったのでソースの簡単な解説をまじえつつ手順を紹介してみます。

# 目次

[TOC]


# 準備

## ソースをとってくる
本家サイトからソースをおとします。とりあえず現在の最新版(1.5)でいいと思います。

[http://tmux.sourceforge.net/](http://tmux.sourceforge.net/)


## 依存パッケージを入れる
[tmatsuuさんの記事](http://d.hatena.ne.jp/tmatsuu/20111130/1322677832)にもちょっとありましたが、
tmuxはlibeventとnlcursesに依存しているのでビルドするにはライブラリのヘッダも必要です。
ubuntuだとたぶん以下パッケージを入れとけば大丈夫です。

$$code(lang=bash)
sudo apt-get install libevent-dev libncurses5-dev
$$/code

## とりあえずビルド

$$code(lang=bash)
./configure && make
$$/code

ここまでできたら準備OKです。


# ソース構成

結構たくさんファイルがありますが、ファイル名を見れば大体雰囲気がつかめると思います。

何か機能を追加したいだけなら、いじる必要のあるファイルはごく一部です。

tmux.h
: ほとんどのコマンドは全部ここに宣言がまとめられてるのでほぼ必ずいじります。
options-table.c
: オプション追加する場合はここに追加します。値の肩などを定義するテーブルが宣言されているので、中身を見れば大体わかると思います。


いじる必要はないですがarray.hはいろんなところでつかわれてるので目を通しとくとよいと思います。
Cでリストが使いたい場合は他のとこでも流用できそうな便利なヘッダです。


あとは必要に応じて関係しそうなところをみていけばよいです。


# いじってみる

今回追加したのは、list-buffersに格納される文字列の順番を逆順にする機能です。

tmuxでバッファに文字列をコピーした場合、バッファの一覧はキューのような構造で新しいものほど前方になる動きをします。
でもこの動きだとホスト名とかよくつかうコマンドとかをずっと前の方においておきたいのに、バッファに何か追加するたびに後ろにずれていって不便に感じることがよくありました。

要するにキューではなくスタックのように動いてほしかったわけです。

