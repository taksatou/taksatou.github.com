


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    
  <title>
mojavy.com
</title>
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
<link rel="alternate" type="application/atom+xml" title="Atom 1.0"
href="/blog/feed/atom" />
<link rel='stylesheet' href='/css/pygments_murphy.css' type='text/css' />


<link href='http://fonts.googleapis.com/css?family=Ubuntu:regular,bold' rel='stylesheet' type='text/css' />
<link href='http://fonts.googleapis.com/css?family=Vollkorn:regular,italic,bold' rel='stylesheet' type='text/css'>
<!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
<!--[if lt IE 9]><script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js"></script><![endif]-->

<link rel='stylesheet' href="/styles/styles.css" type='text/css' />
<link rel='stylesheet' href='http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/themes/pepper-grinder/jquery-ui.css' type='text/css' />
<script src="https://www.google.com/jsapi?key=ABQIAAAAcOj4HIzbhVG_glmoxqtIlhSZ8YWc9pfyrPx-qTk3ymJ7vBNWbhSCYgWPuVGOqTugaARvpRrNszeUJQ" type="text/javascript"></script>
<script language="Javascript" type="text/javascript">
  google.load("search", "1");
  google.load("jquery", "1.6.4");
  google.load("jqueryui", "1.8.16");


  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26834066-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

<!-- coderwall -->
<link href="http://coderwall.com/stylesheets/jquery.coderwall.css" media="all" rel="stylesheet" type="text/css">
<script src="http://coderwall.com/javascripts/jquery.coderwall.js"></script>

<rdf:RDF
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:foaf="http://xmlns.com/foaf/0.1/">
  <rdf:Description rdf:about="http://mojavy.com/">
    <foaf:maker rdf:parseType="Resource">
      <foaf:holdsAccount>
        <foaf:OnlineAccount foaf:accountName="armyofpigs">
          <foaf:accountServiceHomepage rdf:resource="http://www.hatena.ne.jp/" />
        </foaf:OnlineAccount>
      </foaf:holdsAccount>
    </foaf:maker>
  </rdf:Description>
</rdf:RDF>


  </head>
  <body>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1&appId=169540733170142";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

    <div id="content">
      
  <div id="headerwrap">
  <header id="mainheader" class="bodywidth">
    <hgroup id="websitetitle">
      <h1><span class="bold"><a href="/">mojavy.com</a></h1>
      <h2></h2>
    </hgroup>
    <nav>
      <ul>
        <li><a href="/" title="Home">Home</a></li>
        <li><a href="/blog" title="Blog">Blog</a></li>
        <li><a href="/apps.html" title="Apps">Apps</a></li>
        <li><a href="http://twitter.com/#!/taksatou" title="Twitter">Twitter</a></li>
        <li><a href="https://github.com/taksatou" title="github">github</a></li>
        <li><a href="/about.html" title="About">About</a></li>
      </ul>
    </nav>
  </header>
</div>


      <div id="main_block">
        <div id="prose_block">
          
<div id="maincontent2" class="bodywidth">
<div id="blogleft">
  
<div class="blog_post">
  <a name="tmuxでalcの英単語を引く"></a>
  <h2 class="blog_post_title"><a href="http://mojavy.com/blog/2013/01/11/alc-nokogiri-tmux/" rel="bookmark" title="Permanent Link to tmuxでalcの英単語を引く">tmuxでalcの英単語を引く</a></h2>
  <small>January 11, 2013 at 10:00 PM | categories:

<a href='/blog/category/ruby'>ruby</a>, <a href='/blog/category/tmux'>tmux</a>, <a href='/blog/category/english'>english</a>
 | <a href="http://mojavy.com/blog/2013/01/11/alc-nokogiri-tmux/#disqus_thread"></a>
</small>
<p/>
  <div class="post_prose">
    
<div class="blogbody">
  <p><img alt="english" src="/images/english-200.png" /></p>
<p><b>2013-01-15追記 規約違反とのコメント頂いたのでスクレイピングするスクリプトを削除しました。</b></p>
<p>tmuxのcommand-promptを使うと任意のコマンドをインタラクティブに実行できます。
これをつかってtmux上でalcの英単語を表示できるようにしたら思いの外便利だったので紹介します。</p>
<p>まず、alcの検索結果をスクレイビングしていい感じに表示するコマンドをつくります。
rubyのnokogiriとrainbowに依存してますが、ぼくがつくった適当なスクリプトでよければこれを使って下さい。</p>
<div class="pygments_murphy"><pre><span class="c1"># 2013-01-15 削除しました</span>
</pre></div>

<p>これをパスの通った場所にalcという名前で保存して、.tmux.confに以下の設定を追記します。</p>
<div class="pygments_murphy"><pre>unbind C-a
<span class="nb">bind </span>C-a <span class="nb">command</span>-prompt <span class="s2">&quot;split-window -h &#39;alc %% | lv -c&#39;&quot;</span>
</pre></div>

<p>C-aにバインドしてますがお好みのキーに変えてください。
rainbowで色付けしてるのでエスケープシーケンスを解釈できるpagerをつかって下さい。</p>
<p>これで.tmux.confをリロードして、prefix-key C-a とかするとtmux上にプロンプトが表示されるので、そこで調べたい単語を入力します。
そうすると新しいpaneに結果が表示されます。pagerを閉じると自動的にpaneも閉じます。</p>
</div>

  </div>
</div>

<div class='shareaholic-canvas' data-shareaholic-widgets='recommendations'></div>


<div id="prev_next_link">
  <a href="http://mojavy.com/blog/2013/01/09/yaml-mode-ext/"> previous post </a>
    |
  <a href="http://mojavy.com/blog/2013/01/21/c-string-initialization/"> next post </a>
</div>
<hr class="intersocial">

<div style="position:relative; top:-3px;" class="fb-like" data-href="http://mojavy.com/blog/2013/01/11/alc-nokogiri-tmux/" data-send="false" data-layout="button_count" data-width="20" data-show-faces="true"></div>
<a href="http://b.hatena.ne.jp/entry/http://mojavy.com/blog/2013/01/11/alc-nokogiri-tmux/" class="hatena-bookmark-button" data-hatena-bookmark-title="tmuxでalcの英単語を引く" data-hatena-bookmark-layout="simple-balloon" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://mojavy.com/blog/2013/01/11/alc-nokogiri-tmux/" data-text="tmuxでalcの英単語を引く">Tweet</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<div class="g-plusone" data-size="medium" data-href="http://mojavy.com/blog/2013/01/11/alc-nokogiri-tmux/"></div>


  <div class="interblog-sep"><hr class="interblog" /></div>
  
<div class="blog_post">
  <a name="yaml-modeを拡張してyamlを高速に編集する"></a>
  <h2 class="blog_post_title"><a href="http://mojavy.com/blog/2013/01/09/yaml-mode-ext/" rel="bookmark" title="Permanent Link to yaml-modeを拡張してyamlを高速に編集する">yaml-modeを拡張してyamlを高速に編集する</a></h2>
  <small>January 09, 2013 at 10:00 PM | categories:

<a href='/blog/category/elisp'>elisp</a>, <a href='/blog/category/emacs'>emacs</a>
 | <a href="http://mojavy.com/blog/2013/01/09/yaml-mode-ext/#disqus_thread"></a>
</small>
<p/>
  <div class="post_prose">
    
<div class="blogbody">
  <p><img alt="emacs" src="/images/carbon-emacs-icon-200.png" /></p>
<p>とあるプロジェクトで巨大なyamlを編集しなければならない時があるのですが、素の<a href="https://github.com/yoshiki/yaml-mode">yaml-mode</a>だけだと非力に感じたので拡張するためのemacs lispを書きました。</p>
<p>といっても、現状ではブロック単位で移動する関数を適当にyaml-mode-mapにバインドしているだけの単純なものです。</p>
<p>使い方は、<a href="https://github.com/taksatou/yaml-mode-ext">https://github.com/taksatou/yaml-mode-ext</a>からおとしてきてloadするだけです。
(yaml-modeはあらかじめインストールしておく必要があります)</p>
<div class="pygments_murphy"><pre>(load-file &quot;path/to/yaml-mode-ext.el&quot;)
</pre></div>

<p>以下のキーバインドが使えます。</p>
<ul>
<li>M-C-f  同じ階層の次のブロックへ移動</li>
<li>M-C-b  同じ階層の前のブロックへ移動</li>
<li>M-C-u  親ブロックの先頭へ移動</li>
<li>M-C-e  親ブロックの末尾へ移動</li>
<li>M-C-d  直下の子ブロックへ移動</li>
</ul>
<p>当初はyaml-modeをhideshow.elに対応させようと思ってたのですが、ブロック単位で移動ができるようになったところで満足してしまいました。</p>
<p>なお、ブロックの境界はインデントレベルだけをみて判定しているのでyamlに限定する必要はなかった気はしますが、pythonとかhaskellとかでもつかいたくなってきたら書き直そうと思います。</p>
</div>

  </div>
</div>

<div class='shareaholic-canvas' data-shareaholic-widgets='recommendations'></div>


<div id="prev_next_link">
  <a href="http://mojavy.com/blog/2013/01/08/favorite-linux-command/"> previous post </a>
    |
  <a href="http://mojavy.com/blog/2013/01/11/alc-nokogiri-tmux/"> next post </a>
</div>
<hr class="intersocial">

<div style="position:relative; top:-3px;" class="fb-like" data-href="http://mojavy.com/blog/2013/01/09/yaml-mode-ext/" data-send="false" data-layout="button_count" data-width="20" data-show-faces="true"></div>
<a href="http://b.hatena.ne.jp/entry/http://mojavy.com/blog/2013/01/09/yaml-mode-ext/" class="hatena-bookmark-button" data-hatena-bookmark-title="yaml-modeを拡張してyamlを高速に編集する" data-hatena-bookmark-layout="simple-balloon" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://mojavy.com/blog/2013/01/09/yaml-mode-ext/" data-text="yaml-modeを拡張してyamlを高速に編集する">Tweet</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<div class="g-plusone" data-size="medium" data-href="http://mojavy.com/blog/2013/01/09/yaml-mode-ext/"></div>


  <div class="interblog-sep"><hr class="interblog" /></div>
  
<div class="blog_post">
  <a name="おやつの時間をお知らせしてくれるunixコマンド：at-teatime-(他...)"></a>
  <h2 class="blog_post_title"><a href="http://mojavy.com/blog/2013/01/08/favorite-linux-command/" rel="bookmark" title="Permanent Link to おやつの時間をお知らせしてくれるUnixコマンド：at teatime (他...)">おやつの時間をお知らせしてくれるUnixコマンド：at teatime (他...)</a></h2>
  <small>January 08, 2013 at 08:30 PM | categories:

<a href='/blog/category/unix'>unix</a>, <a href='/blog/category/tips'>tips</a>, <a href='/blog/category/linux'>linux</a>
 | <a href="http://mojavy.com/blog/2013/01/08/favorite-linux-command/#disqus_thread"></a>
</small>
<p/>
  <div class="post_prose">
    
<div class="blogbody">
  <p><img alt="banana" src="/images/banana-200.png" /></p>
<p><a href="http://clippy.in/b/YJLM9W">Favorite Linux Commands(http://clippy.in/b/YJLM9W)</a> で紹介されてたコマンドのうち知らなかったものをメモ。</p>
<h2 id="at">at</h2>
<p>入力されたコマンドを指定されたタイミングで実行するようにスケジュールする。
cronに登録するほどでもない単発のコマンドを実行したいときとかにつかう。
時間の指定には現在の時刻からの経過時間や絶対時間の他にteatimeやmidnightといった文字列もつかえる。
ちなみにteatimeは午後4時。
出力先を指定しなければコマンドの出力はcronと同じようにメールにとぶ。$TTYにリダイレクトしてやればコマンドを実行した端末に表示させることもできる。</p>
<p>例</p>
<div class="pygments_murphy"><pre>echo &quot;echo おやつの時間です &gt; $TTY&quot;| at teatime
echo &quot;echo はろー &gt; $TTY&quot; | at now + 3 minute
</pre></div>

<h2 id="mtr">mtr</h2>
<p>tracerouteとpingをあわせたようなもの。tracerouteより表示がみやすい。
ネットワークのどこで時間がかかってるのか一目でわかる。</p>
<p>例</p>
<div class="pygments_murphy"><pre>mtr mojavy.com
</pre></div>

<h2 id="column">column</h2>
<p>入力テキストをいい感じのカラム表示にフォーマットしてくれる。
縦に長い出力するコマンドとか、そのままだと出力がみづらいときとかにつかう。</p>
<p>例</p>
<div class="pygments_murphy"><pre>gem list | column
mount | column -t
grep -v &#39;^#&#39; /etc/apt/sources.list | column -t
</pre></div>

<h2 id="reset">reset</h2>
<p>端末をリセットする。
うっかりバイナリファイルをcatとかしてしまって端末が壊れてしまった場合に端末を閉じずに復帰できる。</p>
<h2 id="sshfs">sshfs</h2>
<p>ssh経由でリモートのファイルシステムをマウントできる。</p>
<p>例</p>
<div class="pygments_murphy"><pre>sshfs name@server:/path/to/dir /path/to/mount/point
fusermount -u /path/to/mount/point  # unmount
</pre></div>

<h2 id="_1">その他</h2>
<p>以下はコマンド自体の機能ではないけど覚えておくと便利かもしれないもの</p>
<h3 id="curl-ifconfigme">curl ifconfig.me</h3>
<p>ifconfig.meというサイトがある。自分のグローバルIPがわかる。</p>
<h3 id="dig-short-txt-wzxhzdk5wpdgcx">dig +short txt <keyword>.wp.dg.cx</h3>
<p>dnsクエリでwikipediaのエントリーがみれる。</p>
<p>例</p>
<div class="pygments_murphy"><pre><span class="nv">$ </span>dig +short txt banana.wp.dg.cx
<span class="s2">&quot;Banana is the common name for herbaceous plants of the genus Musa and for the fruit they produce. It is one of the oldest cultivated plants. They are native to tropical South and Southeast Asia, and are likely to have been first domesticated in Papua New &quot;</span> <span class="s2">&quot;Guinea. Today, they are cultivated throughout the tropics. They are grown in at least 107 countries, primarily for their... http://en.wikipedia.org/wiki/Banana&quot;</span>
</pre></div>
</div>

  </div>
</div>

<div class='shareaholic-canvas' data-shareaholic-widgets='recommendations'></div>


<div id="prev_next_link">
  <a href="http://mojavy.com/blog/2013/01/08/2012-summary/"> previous post </a>
    |
  <a href="http://mojavy.com/blog/2013/01/09/yaml-mode-ext/"> next post </a>
</div>
<hr class="intersocial">

<div style="position:relative; top:-3px;" class="fb-like" data-href="http://mojavy.com/blog/2013/01/08/favorite-linux-command/" data-send="false" data-layout="button_count" data-width="20" data-show-faces="true"></div>
<a href="http://b.hatena.ne.jp/entry/http://mojavy.com/blog/2013/01/08/favorite-linux-command/" class="hatena-bookmark-button" data-hatena-bookmark-title="おやつの時間をお知らせしてくれるUnixコマンド：at teatime (他...)" data-hatena-bookmark-layout="simple-balloon" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://mojavy.com/blog/2013/01/08/favorite-linux-command/" data-text="おやつの時間をお知らせしてくれるUnixコマンド：at teatime (他...)">Tweet</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<div class="g-plusone" data-size="medium" data-href="http://mojavy.com/blog/2013/01/08/favorite-linux-command/"></div>


  <div class="interblog-sep"><hr class="interblog" /></div>
  
<div class="blog_post">
  <a name="2012年の振り返りと2013年の抱負"></a>
  <h2 class="blog_post_title"><a href="http://mojavy.com/blog/2013/01/08/2012-summary/" rel="bookmark" title="Permanent Link to 2012年の振り返りと2013年の抱負">2012年の振り返りと2013年の抱負</a></h2>
  <small>January 08, 2013 at 12:30 AM | categories:

<a href='/blog/category/others'>others</a>
 | <a href="http://mojavy.com/blog/2013/01/08/2012-summary/#disqus_thread"></a>
</small>
<p/>
  <div class="post_prose">
    
<div class="blogbody">
  <p><img alt="tool" src="/images/snake-200.png" /></p>
<p>早いもので1月も8日に突入してしまいましたが、2012年の振り返りと今年の抱負について書いておこうと思います。</p>
<p>2012年にやったことのうち思いだせる範囲かつ主観的にみてそれなりにやった感のあるものを列挙してみます。</p>
<ul>
<li>Androidアプリ開発</li>
<li>iOSアプリ開発</li>
<li>Unityゲーム開発</li>
<li>Common Lisp</li>
<li>Phonegap (Cordova)</li>
<li>Hadoop</li>
<li>HBase</li>
<li>Symfony</li>
<li>FuelPHP</li>
<li>Jenkins</li>
<li>Gearman</li>
</ul>
<p>こうしてならべてみると色々やった年でした。今年だけでC#, Objective-C, Common Lispの3つの言語を新たに使えるようになったし、新しいものを多くやったという意味ではよかったです。
ただ、長い目で見て有用なスキルが身に付いたかというとそうでもない気がします。技術的に深く掘り下げたものがあまりなかったのも残念です。</p>
<p>また、転職や引越しがあったり、自炊をするようになったり、持ってた本をほぼ全部bookscanで電子書籍化したり、とプライベートの生活はそれなりに変化がありました。</p>
<p>今後やりたいことは色々ありますが、もろもろ短かくまとめて</p>
<ul>
<li>心身を鍛える</li>
<li>たくさん遊ぶ</li>
</ul>
<p>というのを2013年の抱負としてやっていこうかと思ってます。</p>
<p>今年もよろしくお願いします。</p>
</div>

  </div>
</div>

<div class='shareaholic-canvas' data-shareaholic-widgets='recommendations'></div>


<div id="prev_next_link">
  <a href="http://mojavy.com/blog/2012/12/16/common-lisp-libraries-advent-calendar-2012-16/"> previous post </a>
    |
  <a href="http://mojavy.com/blog/2013/01/08/favorite-linux-command/"> next post </a>
</div>
<hr class="intersocial">

<div style="position:relative; top:-3px;" class="fb-like" data-href="http://mojavy.com/blog/2013/01/08/2012-summary/" data-send="false" data-layout="button_count" data-width="20" data-show-faces="true"></div>
<a href="http://b.hatena.ne.jp/entry/http://mojavy.com/blog/2013/01/08/2012-summary/" class="hatena-bookmark-button" data-hatena-bookmark-title="2012年の振り返りと2013年の抱負" data-hatena-bookmark-layout="simple-balloon" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://mojavy.com/blog/2013/01/08/2012-summary/" data-text="2012年の振り返りと2013年の抱負">Tweet</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<div class="g-plusone" data-size="medium" data-href="http://mojavy.com/blog/2013/01/08/2012-summary/"></div>


  <div class="interblog-sep"><hr class="interblog" /></div>
  
<div class="blog_post">
  <a name="gearmanクライアントライブラリ-cl-gearman"></a>
  <h2 class="blog_post_title"><a href="http://mojavy.com/blog/2012/12/16/common-lisp-libraries-advent-calendar-2012-16/" rel="bookmark" title="Permanent Link to gearmanクライアントライブラリ cl-gearman">gearmanクライアントライブラリ cl-gearman</a></h2>
  <small>December 16, 2012 at 05:30 PM | categories:

<a href='/blog/category/gearman'>gearman</a>, <a href='/blog/category/common-lisp'>common lisp</a>
 | <a href="http://mojavy.com/blog/2012/12/16/common-lisp-libraries-advent-calendar-2012-16/#disqus_thread"></a>
</small>
<p/>
  <div class="post_prose">
    
<div class="blogbody">
  <p><img alt="tool" src="/images/gearman-logo.png" /></p>
<p><b>この投稿は<a href="http://qiita.com/advent-calendar/2012/clladvent">Common Lisp Libraries Advent Calendar 2012</a>の16日目の記事です。</b></p>
<p>GearmanをCommon Lispから使いたかったのですが、既存のものが見付からなかったのでcl-gearmanというものをつくってみました。というわけで紹介、もとい宣伝をさせてもらおうと思います。</p>
<h2 id="gearman">Gearmanとは</h2>
<p>今更感はありますが、Gearman自体について簡単に説明しておきます。</p>
<p><a href="http://gearman.org/">http://gearman.org/</a></p>
<p>Gearmanとは時間のかかる処理を複数のコンピュータに振り分けるように設計されたオープンソースのアプリケーションフレームワークです。Gearmanを利用するアプリケーションでは、client, job server, workerという3つの要素が存在します。
それぞれの役割は以下の通りです。</p>
<ul>
<li>job server: clientから受けとったジョブを適切なworkerに渡す</li>
<li>client: ジョブを生成してjob serverに送信する</li>
<li>worker: job serverを経由して、clientによってリクエストされたジョブを実行してそのレスポンスを返す</li>
</ul>
<p>cl-gearmanは、clientとjob server間、及びworkerとjob server間のプロトコルを抽象化したライブラリです。</p>
<p>余談ですが、Gearmanはデータ永続化をしないものだとずっと思っていたのですがmysqlやsqliteに永続化できます。
ジョブキューを使うなら以前はTheSchwartzという選択肢もありましたが、今はGearmanでほとんどの場合に対応できるのではないでしょうか。</p>
<h2 id="_1">インストール</h2>
<p>まだquicklispに登録されていないので、githubからソースコードをダウンロードして下さい。(後日申請予定)</p>
<p><a href="https://github.com/taksatou/cl-gearman">https://github.com/taksatou/cl-gearman</a></p>
<div class="pygments_murphy"><pre><span class="nb">cd</span> ~/quicklisp/local-projects
git clone https://github.com/taksatou/cl-gearman.git
</pre></div>

<h2 id="_2">使い方</h2>
<p>以下サンプルコードです</p>
<h3 id="client">client</h3>
<p>submit-jobはjob serverにジョブを送信し、workerがそれを完了するまで待機します。workerが処理を完了するとその返り値が文字列で返されます。</p>
<div class="pygments_murphy"><pre>CL-USER&gt; (cl-gearman:with-client (client &quot;localhost:4730&quot;)
           (format t &quot;~a~%&quot; (cl-gearman:submit-job client &quot;hello&quot;))
           (format t &quot;~a~%&quot; (cl-gearman:submit-job client &quot;echo&quot; :arg &quot;foo)))
hello
foo
NIL
</pre></div>

<p>以下のようにしてバックグランドでジョブを実行することもできます。バックグランドでジョブを実行するとjobオブジェクトが即座に返されます。
そのjobオブジェクトをつかって、ジョブのステータスを取得することができます。以下の例では見辛いですが、priorityを付けることでジョブの実行順を多少は制御できます。</p>
<div class="pygments_murphy"><pre>CL-USER&gt; (cl-gearman:with-client (client &quot;localhost:4730&quot;)
           (let* ((job1 (cl-gearman:submit-background-job client &quot;sleep&quot; :arg &quot;1&quot;))
                  (job2 (cl-gearman:submit-background-job client &quot;sleep&quot; :arg &quot;1&quot; :priority :low))
                  (job3 (cl-gearman:submit-background-job client &quot;sleep&quot; :arg &quot;1&quot; :priority :high))
                  (jobs `(:medium ,job1 :low ,job2 :high ,job3)))

             (dotimes (i 5)
               (loop for (k v) on jobs by #&#39;cddr
                  do (format t &quot;~a: ~a~%&quot; k (cl-gearman:get-job-status client v)))
               (sleep 1))))
MEDIUM: (JOB-HANDLE H:hostname:109 IS-KNOWN 1 IS-RUNNING 1 PROGRESS NAN)
LOW: (JOB-HANDLE H:hostname:110 IS-KNOWN 1 IS-RUNNING 0 PROGRESS NAN)
HIGH: (JOB-HANDLE H:hostname:111 IS-KNOWN 1 IS-RUNNING 0 PROGRESS NAN)
MEDIUM: (JOB-HANDLE H:hostname:109 IS-KNOWN 0 IS-RUNNING 0 PROGRESS NAN)
LOW: (JOB-HANDLE H:hostname:110 IS-KNOWN 1 IS-RUNNING 0 PROGRESS NAN)
HIGH: (JOB-HANDLE H:hostname:111 IS-KNOWN 1 IS-RUNNING 0 PROGRESS NAN)
MEDIUM: (JOB-HANDLE H:hostname:109 IS-KNOWN 0 IS-RUNNING 0 PROGRESS NAN)
LOW: (JOB-HANDLE H:hostname:110 IS-KNOWN 1 IS-RUNNING 0 PROGRESS NAN)
HIGH: (JOB-HANDLE H:hostname:111 IS-KNOWN 1 IS-RUNNING 1 PROGRESS NAN)
MEDIUM: (JOB-HANDLE H:hostname:109 IS-KNOWN 0 IS-RUNNING 0 PROGRESS NAN)
LOW: (JOB-HANDLE H:hostname:110 IS-KNOWN 1 IS-RUNNING 1 PROGRESS NAN)
HIGH: (JOB-HANDLE H:hostname:111 IS-KNOWN 0 IS-RUNNING 0 PROGRESS NAN)
MEDIUM: (JOB-HANDLE H:hostname:109 IS-KNOWN 0 IS-RUNNING 0 PROGRESS NAN)
LOW: (JOB-HANDLE H:hostname:110 IS-KNOWN 0 IS-RUNNING 0 PROGRESS NAN)
HIGH: (JOB-HANDLE H:hostname:111 IS-KNOWN 0 IS-RUNNING 0 PROGRESS NAN)
NIL
</pre></div>

<h3 id="worker">worker</h3>
<p>workerはadd-abilityで実行できるジョブとそのハンドラをあらかじめ登録する必要があります。
ハンドラは2つの引数をとる関数で、第一引数はclientからのデータ、第二引数はjobオブジェクトです。
返り値はprincでフォーマットした文字列としてclientに渡されます。workを実行するとジョブが割り当てられるまでブロックし、1つのジョブの実行が完了すると戻ります。</p>
<div class="pygments_murphy"><pre>(cl-gearman:with-worker (worker &quot;localhost:4730&quot;)
  (cl-gearman:add-ability worker &quot;hello&quot;
                          #&#39;(lambda (arg job) &quot;hello&quot;))

  (cl-gearman:add-ability worker &quot;echo&quot;
                          #&#39;(lambda (arg job) arg))

  (cl-gearman:add-ability worker &quot;sleep&quot;
                          #&#39;(lambda (arg job)
                              (sleep (parse-integer arg))
                              (format nil &quot;job:~A finished~%&quot; job)))

  (loop do (cl-gearman:work worker)))
</pre></div>

<h3 id="_3">エラーハンドリング</h3>
<p>ジョブキューを使う上で悩ましいことの一つはエラー処理だと思いますが、Common Lispのコンディションシステムを使えば柔軟に対応できます。
workerのハンドラでは、skip-job, abort-job, retry-job の3パターンのリトライをサポートしています。</p>
<p>例えば、</p>
<div class="pygments_murphy"><pre>(cl-gearman:with-worker (worker &quot;localhost:4730&quot;) 
  (cl-gearman:add-ability worker &quot;error&quot;
                          #&#39;(lambda (arg job) (error &quot;something wrong&quot;)))

  (loop do (handler-bind ((error #&#39;(lambda (c) (invoke-restart &#39;cl-gearman:skip-job))))
             (cl-gearman:work worker))))
</pre></div>

<p>のようにしておけば、エラーが発生したjobを無視することができます。
abort-jobはclientに失敗を通知します。retry-jobは名前の通りハンドラを再度実行します。</p>
<h2 id="_4">対応する処理系</h2>
<p>メインに開発を行った環境は ubuntu 12.04, sbcl 1.0.55.0.debian です。
一応以下の処理系で動作確認しました</p>
<ul>
<li>sbcl 1.0.55.0.debian </li>
<li>clisp 2.49</li>
<li>clozure cl 1.8-r15286M</li>
</ul>
<p>ffi系のライブラリには依存してないので比較的動かしやすいとは思いますが、動かなければ教えて下さい。</p>
<h2 id="_5">まとめ</h2>
<p>以上、拙作のcl-gearmanを紹介しました。Common Lispを始めてまだ半年足らずなのでおかしいところがあるかと思いますが、フィードバックを頂けるとうれしいです。</p>
</div>

  </div>
</div>

<div class='shareaholic-canvas' data-shareaholic-widgets='recommendations'></div>


<div id="prev_next_link">
  <a href="http://mojavy.com/blog/2012/11/20/web-engineers-online-toolbox/"> previous post </a>
    |
  <a href="http://mojavy.com/blog/2013/01/08/2012-summary/"> next post </a>
</div>
<hr class="intersocial">

<div style="position:relative; top:-3px;" class="fb-like" data-href="http://mojavy.com/blog/2012/12/16/common-lisp-libraries-advent-calendar-2012-16/" data-send="false" data-layout="button_count" data-width="20" data-show-faces="true"></div>
<a href="http://b.hatena.ne.jp/entry/http://mojavy.com/blog/2012/12/16/common-lisp-libraries-advent-calendar-2012-16/" class="hatena-bookmark-button" data-hatena-bookmark-title="gearmanクライアントライブラリ cl-gearman" data-hatena-bookmark-layout="simple-balloon" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://mojavy.com/blog/2012/12/16/common-lisp-libraries-advent-calendar-2012-16/" data-text="gearmanクライアントライブラリ cl-gearman">Tweet</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<div class="g-plusone" data-size="medium" data-href="http://mojavy.com/blog/2012/12/16/common-lisp-libraries-advent-calendar-2012-16/"></div>


  <div class="interblog-sep"><hr class="interblog" /></div>
<div style="text-align: right;">
 <a href="../1">« Previous</a>
  <span style="margin: 0px 3px 0px 3px">...</span>  
 <a href="../3">Next »</a>
</div>

</div>
<section id="blogright">
  <div id="aboutme">
    <h1>About Me</h1>
    <table>
      <td>
        <img src="http://www.gravatar.com/avatar/69238498491bce19f67cf79d528f08ee.png?s=150" alt="pic" />
      </td><td>
        <script>
$(document).ready(function(){$("#aboutme li.msg").html("雑食です");});
        </script>
        <h6>mojavy</h6>
        <ul>
          <li class="msg"></li>
        </ul>
      </td>
    </table>
  </div>

<hr />
  <div id="recent_posts">			
    <h1>Recent posts</h1>
    <ul>
      <li><a href="/blog/2013/02/18/ltsv-for-common-list/" title="LTSV for Common Lisp 作りました"><p>LTSV for Common Lisp 作りました</a><span style="font-size: 80%;">(February 18, 2013 at 08:30 PM)</span></li>
      <li><a href="/blog/2013/02/09/sbcl-defconstant/" title="common lispのdefconstantについての注意点"><p>common lispのdefconstantについての注意点</a><span style="font-size: 80%;">(February 09, 2013 at 05:15 PM)</span></li>
      <li><a href="/blog/2013/02/06/quicklinks4/" title="Quicklinks 4"><p>Quicklinks 4</a><span style="font-size: 80%;">(February 06, 2013 at 09:50 PM)</span></li>
      <li><a href="/blog/2013/02/05/popular-programming-languages/" title="人気プログラミング言語ランキング(stackoverflow調べ)"><p>人気プログラミング言語ランキング(stackoverflow調べ)</a><span style="font-size: 80%;">(February 05, 2013 at 11:00 PM)</span></li>
      <li><a href="/blog/2013/01/21/c-string-initialization/" title="C言語の文字列初期化について"><p>C言語の文字列初期化について</a><span style="font-size: 80%;">(January 21, 2013 at 08:00 PM)</span></li>
      <li><a href="/blog/2013/01/11/alc-nokogiri-tmux/" title="tmuxでalcの英単語を引く"><p>tmuxでalcの英単語を引く</a><span style="font-size: 80%;">(January 11, 2013 at 10:00 PM)</span></li>
      <li><a href="/blog/2013/01/09/yaml-mode-ext/" title="yaml-modeを拡張してyamlを高速に編集する"><p>yaml-modeを拡張してyamlを高速に編集する</a><span style="font-size: 80%;">(January 09, 2013 at 10:00 PM)</span></li>
      <li><a href="/blog/2013/01/08/favorite-linux-command/" title="おやつの時間をお知らせしてくれるUnixコマンド：at teatime (他...)"><p>おやつの時間をお知らせしてくれるUnixコマンド：at teatime (他...)</a><span style="font-size: 80%;">(January 08, 2013 at 08:30 PM)</span></li>
    </ul>
  </div>

<hr />
  <div id="hatena_popular">
    <h1>Recent Popular posts</h1>
<script language="javascript" type="text/javascript" src="http://b.hatena.ne.jp/js/widget.js" charset="utf-8"></script>
<script language="javascript" type="text/javascript">
Hatena.BookmarkWidget.url   = "http://mojavy.com/";
Hatena.BookmarkWidget.title = "";
Hatena.BookmarkWidget.sort  = "";
Hatena.BookmarkWidget.width = 0;
Hatena.BookmarkWidget.num   = 5;
Hatena.BookmarkWidget.theme = "hatenadiary";
Hatena.BookmarkWidget.load();
</script>
  </div><br>

<hr />
<div id="hatena_popular">
  <h1>Popular posts</h1>
  <script language="javascript" type="text/javascript" src="http://b.hatena.ne.jp/js/widget.js" charset="utf-8"></script>
  <script language="javascript" type="text/javascript">
    Hatena.BookmarkWidget.url   = "http://mojavy.com/";
    Hatena.BookmarkWidget.title = "";
    Hatena.BookmarkWidget.sort  = "count";
    Hatena.BookmarkWidget.width = 0;
    Hatena.BookmarkWidget.num   = 5;
    Hatena.BookmarkWidget.theme = "hatenadiary";
    Hatena.BookmarkWidget.load();
  </script>
</div><br>

<hr />
  <div id="categories">
    <h1>Categories</h1>
    <ul>
     <li><a href="/blog/category/c">C</a> (<a href="/blog/category/c/feed">rss</a>) (1)</li>
     <li><a href="/blog/category/advent-calendar">advent calendar</a> (<a href="/blog/category/advent-calendar/feed">rss</a>) (2)</li>
     <li><a href="/blog/category/algorithms">algorithms</a> (<a href="/blog/category/algorithms/feed">rss</a>) (1)</li>
     <li><a href="/blog/category/android">android</a> (<a href="/blog/category/android/feed">rss</a>) (1)</li>
     <li><a href="/blog/category/blog">blog</a> (<a href="/blog/category/blog/feed">rss</a>) (1)</li>
     <li><a href="/blog/category/blogofile">blogofile</a> (<a href="/blog/category/blogofile/feed">rss</a>) (2)</li>
     <li><a href="/blog/category/common-lisp">common lisp</a> (<a href="/blog/category/common-lisp/feed">rss</a>) (9)</li>
     <li><a href="/blog/category/elisp">elisp</a> (<a href="/blog/category/elisp/feed">rss</a>) (1)</li>
     <li><a href="/blog/category/emacs">emacs</a> (<a href="/blog/category/emacs/feed">rss</a>) (1)</li>
     <li><a href="/blog/category/english">english</a> (<a href="/blog/category/english/feed">rss</a>) (1)</li>
     <li><a href="/blog/category/gearman">gearman</a> (<a href="/blog/category/gearman/feed">rss</a>) (1)</li>
     <li><a href="/blog/category/ios">ios</a> (<a href="/blog/category/ios/feed">rss</a>) (3)</li>
     <li><a href="/blog/category/jenkins">jenkins</a> (<a href="/blog/category/jenkins/feed">rss</a>) (1)</li>
     <li><a href="/blog/category/linux">linux</a> (<a href="/blog/category/linux/feed">rss</a>) (2)</li>
     <li><a href="/blog/category/ltsv">ltsv</a> (<a href="/blog/category/ltsv/feed">rss</a>) (1)</li>
     <li><a href="/blog/category/mac">mac</a> (<a href="/blog/category/mac/feed">rss</a>) (1)</li>
     <li><a href="/blog/category/memo">memo</a> (<a href="/blog/category/memo/feed">rss</a>) (2)</li>
     <li><a href="/blog/category/objective-c">objective-c</a> (<a href="/blog/category/objective-c/feed">rss</a>) (4)</li>
     <li><a href="/blog/category/others">others</a> (<a href="/blog/category/others/feed">rss</a>) (1)</li>
     <li><a href="/blog/category/paco">paco</a> (<a href="/blog/category/paco/feed">rss</a>) (1)</li>
     <li><a href="/blog/category/pdf">pdf</a> (<a href="/blog/category/pdf/feed">rss</a>) (1)</li>
     <li><a href="/blog/category/programming">programming</a> (<a href="/blog/category/programming/feed">rss</a>) (3)</li>
     <li><a href="/blog/category/python">python</a> (<a href="/blog/category/python/feed">rss</a>) (4)</li>
     <li><a href="/blog/category/quicklinks">quicklinks</a> (<a href="/blog/category/quicklinks/feed">rss</a>) (4)</li>
     <li><a href="/blog/category/redmine">redmine</a> (<a href="/blog/category/redmine/feed">rss</a>) (1)</li>
     <li><a href="/blog/category/ruby">ruby</a> (<a href="/blog/category/ruby/feed">rss</a>) (3)</li>
     <li><a href="/blog/category/sbcl">sbcl</a> (<a href="/blog/category/sbcl/feed">rss</a>) (2)</li>
     <li><a href="/blog/category/tips">tips</a> (<a href="/blog/category/tips/feed">rss</a>) (5)</li>
     <li><a href="/blog/category/tmux">tmux</a> (<a href="/blog/category/tmux/feed">rss</a>) (3)</li>
     <li><a href="/blog/category/twitter">twitter</a> (<a href="/blog/category/twitter/feed">rss</a>) (1)</li>
     <li><a href="/blog/category/ubuntu">ubuntu</a> (<a href="/blog/category/ubuntu/feed">rss</a>) (1)</li>
     <li><a href="/blog/category/unix">unix</a> (<a href="/blog/category/unix/feed">rss</a>) (1)</li>
     <li><a href="/blog/category/web">web</a> (<a href="/blog/category/web/feed">rss</a>) (3)</li>
     <li><a href="/blog/category/xcode">xcode</a> (<a href="/blog/category/xcode/feed">rss</a>) (1)</li>
     <li><a href="/blog/category/zeromq">zeromq</a> (<a href="/blog/category/zeromq/feed">rss</a>) (2)</li>
    </ul>
  </div> 

<hr />
  <div id="archives">			
    <h1>Archives</h1>
    <ul>
      <li><a href="/blog/archive/2013/02/1" title="February 2013">February 2013</a>&nbsp;(4)</li>
      <li><a href="/blog/archive/2013/01/1" title="January 2013">January 2013</a>&nbsp;(5)</li>
      <li><a href="/blog/archive/2012/12/1" title="December 2012">December 2012</a>&nbsp;(1)</li>
      <li><a href="/blog/archive/2012/11/1" title="November 2012">November 2012</a>&nbsp;(6)</li>
      <li><a href="/blog/archive/2012/10/1" title="October 2012">October 2012</a>&nbsp;(7)</li>
      <li><a href="/blog/archive/2012/08/1" title="August 2012">August 2012</a>&nbsp;(1)</li>
      <li><a href="/blog/archive/2012/07/1" title="July 2012">July 2012</a>&nbsp;(9)</li>
      <li><a href="/blog/archive/2012/06/1" title="June 2012">June 2012</a>&nbsp;(1)</li>
      <li><a href="/blog/archive/2012/04/1" title="April 2012">April 2012</a>&nbsp;(1)</li>
      <li><a href="/blog/archive/2011/12/1" title="December 2011">December 2011</a>&nbsp;(2)</li>
      <li><a href="/blog/archive/2011/11/1" title="November 2011">November 2011</a>&nbsp;(2)</li>
    </ul>
  </div>

<hr />
  <div id="coderwall">
    <h1>Badges</h1>
    <section class="coderwall" data-coderwall-username="taksatou" data-coderwall-orientation="vertical"></section>
  </div><br>

</section>
</div>

        </div><!-- End Prose Block -->
      </div><!-- End Main Block -->
      <div id="footer">
        
  <div id="feedicon">
  <a href="/blog/feed"><img src="/images/rss_icon.png" alt="rss" /></a>
  </div>

<div id="footerwrap">
  <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
  </script>

  <footer id="mainfooter" class="bodywidth">
    
    <p class="copyright">Powered by <a href="http://www.blogofile.com">Blogofile</a>.<br>Copyright &copy; 2011 <a href="/" title="">mojavy</a>. </p>
    

  </footer>
</div>
<script type="text/javascript">
//<![CDATA[
(function() {
		var links = document.getElementsByTagName('a');
		var query = '?';
		for(var i = 0; i < links.length; i++) {
			if(links[i].href.indexOf('#disqus_thread') >= 0) {
				query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
			}
		}
		document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/mojavy/get_num_replies.js' + query + '"></' + 'script>');
	})();
//]]>
</script>


      </div> <!-- End Footer -->
    </div> <!-- End Content -->

    <!-- shareaholic -->
    <script type="text/javascript">
      //<![CDATA[
  (function() {
    var shr = document.createElement('script');
    shr.src = '//dtym7iokkjlif.cloudfront.net/assets/pub/shareaholic.js';
    shr.type = 'text/javascript';
    shr.async = 'true';
    shr.onload = shr.onreadystatechange = function() {
      var rs = this.readyState;
      if (rs && rs != 'complete' && rs != 'loaded') return;
      var apikey = 'd9fb965c81d656a30f7629e4e251e405'
      try { Shareaholic.init(apikey); } catch (e) {}
    };
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(shr, s);
  })();
//]]>
    </script>
  </body>
</html>




